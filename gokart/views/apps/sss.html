{% extends 'layers_annotations.html' %}

{% block title %}Spatial Support System{% endblock %}

{% block tab_panels %}
{{ super() }}
<div class="tabs-panel" id="menu-tab-tracking">
    <div class="row collapse">
        <div class="columns">
            <ul class="tabs" data-tabs id="tracking-tabs">
                <li class="tabs-title is-active"><a href="#tracking-list-tab" aria-selected="true">Resource Tracking</a></li>
                <li class="tabs-title"><a href="#tracking-groups-tab" aria-selected="true">Device Groups</a></li>
            </ul>
        </div>
    </div>
    <div class="row collapse" id="tracking-tab-panels">
        <div class="columns">
            <div class="tabs-content vertical" data-tabs-content="tracking-tabs">
                <div id="tracking-list-tab" class="tabs-panel is-active" v-cloak>{% raw %}
                    <div class="row">
                        <div class="switch tiny">
                            <input class="switch-input" id="resourcesInViewport" type="checkbox" v-model="viewportOnly"/>
                            <label class="switch-paddle" for="resourcesInViewport">
                                <span class="show-for-sr">Viewport resources only</span>
                            </label>
                        </div>
                        <label for="resourcesInViewport" class="side-label">Restrict to viewport ({{ stats }})</label>
                    </div>
                    <div class="row collapse">
                        <div class="small-6 columns">
                            <select name="select" v-model="cql" @change="setCQLFilter(cql)">
                                <option value="" selected>All resources</option> 
                                <option value="symbolid LIKE '%comms_bus'">Communications Bus</option>
                                <option value="symbolid LIKE '%gang_truck'">Gang Truck</option>
                                <option value="symbolid LIKE '%heavy_duty'">Heavy Duty</option>
                                <option value="(symbolid LIKE '%heavy_duty' OR symbolid LIKE '%gang_truck')">GT and HD</option>
                                <option value="symbolid LIKE '%aircraft'">Aircraft</option>
                            </select>
                        </div>
                        <div class="small-6 columns">
                            <input type="search" v-model="search" placeholder="Find a resource">
                        </div>
                    </div>
                    <div class="row">
                        <div class="small-10">
                            <div class="columns"><div class="row">
                                <div class="switch tiny">
                                    <input class="switch-input" id="resourceHistory" type="checkbox" v-model="toggleHistory"/>
                                    <label class="switch-paddle" for="resourceHistory">
                                        <span class="show-for-sr">Query history</span>
                                    </label>
                                </div>
                                <label for="resourceHistory" class="side-label">Query history</label>
                            </div></div>
                            <div class="columns"><div class="row">
                                <div class="switch tiny">
                                    <input class="switch-input" id="selectedOnly" type="checkbox" v-model="selectedOnly"/>
                                    <label class="switch-paddle" for="selectedOnly">
                                        <span class="show-for-sr">Show selected only</span>
                                    </label>
                                </div>
                                <label for="selectedOnly" class="side-label">Show selected only</label>
                            </div></div>
                        </div><div class="small-2">
                            <a class="button" @click="zoomToSelected()" style="float: right"><i class="fa fa-search"></i></a>
                        </div>
                    </div>
                    <div id="history-panel" v-if="toggleHistory">
                        <div class="row collapse tool-slice">
                            <div class="small-2">
                                <label for="historyFrom">From:</label>
                            </div><div class="small-4">
                                <input type="text" v-model="historyFromDate" placeholder="yyyy-mm-dd"></input>
                            </div><div class="small-2">
                                <input type="text" v-model="historyFromTime" placeholder="24:00"></input>
                            </div>
                            <div class="small-4">
                                <select name="select" v-model="history" @change="historyRange = history">
                                    <option value="" selected>Date range</option> 
                                    <!-- values in milliseconds -->
                                    <option value="3600000">Last hour</option> 
                                    <option value="10800000">Last 3 hours</option> 
                                    <option value="86400000">Last day</option> 
                                    <option value="604800000">Last week</option> 
                                    <option value="2678400000">Last month</option> 
                                </select>
                            </div>
                        </div>
                        <div class="row collapse tool-slice">
                            <div class="small-2">
                                <label for="historyTo">To:</label>
                            </div><div class="small-4">
                                <input type="text" v-model="historyToDate" placeholder="yyyy-mm-dd"></input>
                            </div><div class="small-2">
                                <input type="text" v-model="historyToTime" placeholder="24:00"></input>
                            </div>
                            <div class="small-2"></div>
                            <div class="small-2">
                                <button class="button" @click="historyCQLFilter">Go</button>
                            </div>
                        </div>
                    </div>
                    <div id="tracking-list">
                        <div v-for="f in features | filterBy resourceFilter | orderBy resourceOrder" class="row feature-row" v-bind:class="{'device-selected': selected(f) }" @click="select(f)">
                            <partial name="resourceInfo"></partial>
                        </div>
                    </div>
                    {% endraw %}
                </div>
                <div id="tracking-groups-tab" class="tabs-panel">
                    Group search shortcuts here
                </div>
            </div>
        </div>
    </div>
    {% raw %}
    <div id="resourceInfo" class="hide">
        <div class="columns">
            <div class="feature-title"><img v-bind:src="f.get('icon')" /> {{ f.get('label') }} <small>({{ f.get('deviceid') }})</small></div>
            <small>{{ f.get('time') }}</small>
        </div>
    </div>
    {% endraw %}
    <style type="text/css">
        #tracking-list .feature-row {
            cursor: pointer;
            border-right: 1px transparent;
        }
        #tracking-list .feature-row:hover {
            border-right: 1px solid #fff;
        }
        .device-selected {
            background-color: #165016;
        }
        .feature-row:nth-child(even).device-selected {
            background-color: #185a18;
        }


    </style>
</div>
{% endblock %}

{% block tabs %}
{{ super() }}
<li class="tabs-title side-button"><a href="#menu-tab-tracking" title="Vehicle Tracking">
    <svg class="icon"><use xlink:href="static/images/iD-sprite.svg#icon-geolocate"></use></svg>
</a></li>
{% endblock %}

{% block loader_script %}
<script src="static/apps/sss.js"></script>
{% endblock %}
