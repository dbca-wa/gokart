{% extends 'layers_annotations.html' %}

{% block title %}Spatial Support System{% endblock %}

{% block tab_panels %}
{{ super() }}
<div class="tabs-panel" id="menu-tab-tracking">
    Tracking goes here.
</div>
{% endblock %}

{% block tabs %}
{{ super() }}
<li class="tabs-title side-button"><a href="#menu-tab-tracking" title="Vehicle Tracking">
    <svg class="icon"><use xlink:href="/static/images/iD-sprite.svg#icon-geolocate"></use></svg>
</a></li>
{% endblock %}

{% block loader_script %}
<script>
// load map
var symbols_url_base = "/static/symbols/device/";
gokart.init([
    gokart.createWFSLayer({
        'name': "Resource Tracking",
        'id': 'dpaw:resource_tracking',
        'style': function(f) {
            var color = "rgba(255,0,0,0.7)";
            if (f.get("age") < 3) { color = "rgba(255,255,0,0.7)" };
            if (f.get("age") <= 1) { color = "rgba(0,255,0,0.7)" };
            var icon = new ol.style.Icon({
                src: symbols_url_base + f.get("symbolid") + "_64.png",
                scale: .3
            });
            var text = undefined;
            if (gokart.map.getView().getResolution() < .0015) {
                text = new ol.style.Text({ 
                    stroke: new ol.style.Stroke({ color: "#fff;", width: 2 }),
                    textAlign: "left",
                    offsetX: 12
                });
                text.setText(f.get("callsign"));
            }
            f.style = [
                new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 10,
                        fill: new ol.style.Fill({ color: color }),
                        stroke: new ol.style.Stroke({ color: "rgba(0,0,0,0.7)", width: 2 }),
                    }),
                    text: text
                }),
                new ol.style.Style({image: icon})
            ]
        return f.style;
        }
    }),
    gokart.createTileLayer({
        'name': "Virtual Mosaic",
        'id': 'landgate:LGATE-V001'
    }),
]);
</script>
{% endblock %}
