<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Cordova CSP -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob: filesystem: mediastream:;">
    <!-- Unicode is great -->
    <meta charset="utf-8" />
    <title>Spot forecast</title>
    <!-- Disable awful IE compatibility mode -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Force fit-to-viewport sizing on mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <!-- favicon -->
    <link rel="icon" href="dist/static/images/favicon.svg" sizes="any" type="image/svg+xml" />
    <link rel="icon" href="dist/static/images/favicon-256.png" sizes="16x16 32x32 64x64 128x128 256x256" type="image/png" /> 

    <script src="{{staticService}}/static/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="{{staticService}}/static/libs/foundation/6.4.3/js/foundation.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{staticService}}/static/libs/foundation/6.4.3/css/foundation.min.css" />
    <style>
        .hover tbody tr:hover td, .table-hover tbody tr:hover th {
          background-color: #2199e8;
        }

        #spotforecast .daterow {
            background-color:#D2EEFA;
        }

        #spotforecast .time-0-in-day {
            background-color:#white;
        }
        #spotforecast .time-1-in-day {
            background-color:#D6E2E4;
        }
    </style>
  </head>
  <body>
    <div style="margin-left:20px;margin-right:20px;margin-top:20px">
    {%- for forecast in data.forecasts -%}
    <table class="hover" style="border-collapse:separate;background:black" align="center" id="spotforecast">
      <thead>
        <tr>
        {%- if forecast.has_group  -%}
          <th rowspan="2" style="text-align:center">Local Time</th>
        {% else %}
          <th style="text-align:center"> Time </th>
        {% endif %}
        {%- for datasource in forecast.datasources -%}
          {%- if datasource.group -%}
          <th colspan="{{datasource.columns}}" style="text-align:center"> {{ datasource.group|safe }} </th>
          {% else %}
            {%- if forecast.has_group  -%}
              <th rowspan="2" style="text-align:center"> {{ datasource.options.title|safe }}</th>
            {% else %}
              <th style="text-align:center"> {{ datasource.options.title|safe }}</th>
            {% endif %}
          {% endif %}
        {% endfor %}
        </tr>
        {%- if forecast.has_group  -%}
        <tr>
          {%- for datasource in forecast.datasources -%}
            {%- if datasource.group -%}
              {%- for ds in datasource.datasources -%}
                <th style="text-align:center"> {{ ds.options.title|safe }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endif %}

      </thead>
      <tbody>
        {%- set previousDate = initValue() -%}
        {%- set timeIndex = initValue() -%}
        {%- for time in forecast.times -%}
          {%- set index = loop.index0 -%}
          {%- set currentDate = time.strftime(forecast.options.date_pattern) -%}
          {%- if getValue(previousDate) != currentDate -%}
            <tr class="daterow">
              <td colspan="{{forecast.columns}}" style="{{forecast.options.date_style|format("","text-align:left")}}">{{currentDate}}</td>
            </tr>
            {{ setValue(previousDate,currentDate) }}
            {{ setValue(timeIndex,0) }}
          {% else %}
            {{ setValue(timeIndex,(getValue(timeIndex) + 1) % 2) }}
          {% endif %}
          <tr class="time-{{getValue(timeIndex)}}-in-day">
            <td style="{{forecast.options.time_style|format("","text-align:center")}}">{{time |formatDate(forecast.options.time_pattern) }}</td>
          {%- for datasource in forecast.datasources -%}
            {%- if datasource.group -%}
              {%- for ds in datasource.datasources -%}
                {%- if ds.status -%}
                <td style="{{ds.style|format("","text-align:center")}}"> {{ ds.data[index][1]}}</td>
                {% else %}
                  <td style="{{ds.style|format("","text-align:center")}}">{{data.options.no_data}}</td>
                {% endif %}
              {% endfor %}
            {% else %}
              {%- if datasource.status -%}
              <td style="{{datasource.style|format("","text-align:center")}}"> {{ datasource.data[index][1]}}</td>
              {% else %}
                <td style="{{datasource.style|format("","text-align:center")}}">{{data.options.no_data}}</td>
              {% endif %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endfor %}
    </div>
  </body>
</html>
